%header
  .container.clearfix
    .col-md-3
      %a{:href => root_path, :class => "nav-brand"}
        = image_tag 'mrlogo.png'
        %span= 'mattrab'
    .col-md-4
      %form.form-inline.my-2.my-lg-0{:action => "/search"}
        %input.form-control.mr-sm-2{"aria-label" => "Search", :placeholder => "Search", :name => "query", :type => "search"}
        %button.btn.btn-success.my-2.my-sm-0{:type => "submit"} Search
    .col-md-5
      %nav
        - if !user_signed_in?
          %li= link_to "Sign In", new_user_session_path
          %li= link_to "Sign Up", new_user_registration_path
        %li= link_to "Add New Note", new_note_path, class: "btn-hoverable"

        - if user_signed_in?
          .btn-group.pull-right.nav-profile-menu
            %button.btn-nav-profile.dropdown-toogle{ 'type' => 'button', 'data-toogle' => 'dropdown', 'aria-haspopup' => 'true', 'aria-expanded' => 'false' }
              = image_tag current_user.avatar.url(:small)
            .dropdown-menu{ 'role' => 'menu' }
              = link_to current_user.name, current_user, class: 'dropdown-item'
              = link_to "Logout", destroy_user_session_path, method: :delete, class: 'dropdown-item'

        -# = link_to (image_tag current_user.avatar.url(:small)), '#', class: 'img-nav-profile nav-dropdown'
        -# .nav-dropdown-menu
        -#   = link_to current_user.name, current_user, class: 'nav-dropdown-menu-items'
        -#   = link_to "Logout", destroy_user_session_path, method: :delete, class: 'nav-dropdown-menu-items'
          -# - else
          -#   = link_to "Sign In", new_user_session_path
          -#   = link_to "Sign Up", new_user_registration_path, class: "btn-hoverable"

#profile
  .wrapper.clearfix
    - if current_user == @user
      = link_to "Edit Profile", edit_user_registration_path, class: "btn btn-default pull-right"
    %br
    .row
      .col-md-4
        = image_tag @user.avatar.url(:pro), class: "img-circle center"
        - if current_user != @user
          - if !current_user.following?(@user)
            = form_for(current_user.active_relationships.build) do |f|
              = hidden_field_tag :followed_id, @user.id
              = f.submit "Follow", class: "btn btn-follow"
          - else
            = form_for(current_user.active_relationships.find_by(followed_id: @user.id), html: { method: :delete }) do |f|
              = f.submit "Unfollow", class: "btn btn-follow"
      .col-md-8
        %h2.name
          = "Hi, I'm"
          = @user.name
        %p.about= @user.about
        %p.email
          = "@"
          = @user.email
        %p.followers
          = pluralize(@user.followers.count, "Follower")
          = '•'
          = pluralize(@user.notes.count, "Note")

#notes
  .wrapper
    %h3.title= 'Latest Notes'
    .row.flex-grid
      - @user_notes.each do |note|
        .col-md-4
          .note
            = link_to (image_tag note.image.url(:small)), note, class: 'img-note'
            .note_content
              %p.info
                = @user.name
                = '•'
                = 'Science'
              %h2.title= link_to note.title, note
              %p.body
                = truncate(note.body, :length => 150)
              %p.buttons
                %span
                  %i.fa.fa-comments-o
                  = pluralize(note.comments.count, "Comment")
                %span
                  %i.fa.fa-thumbs-o-up
                  = pluralize(note.get_upvotes.size, "Like")
                %span
                  %i.fa.fa-eye
                  = pluralize(note.view, "View")
